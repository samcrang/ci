#!/usr/bin/env bash
set -e

version() {
  echo "CI 0.0.1"
}

teardown() {
  project="$1"
  if [ -f "$project/teardown.sh" ]; then
    bash "$project/teardown.sh"
  fi
}

setup() {
  project="$1"
  if [ -f "$project/setup.sh" ]; then
    bash "$project/setup.sh"
  fi
}

run_project() {
  if [ -d "$project" ]; then
    if [ -f "$project/run.sh" ]; then
      setup "$project"
      set +e
      bash "$project/run.sh" 
      status=$?
      set -e
      teardown "$project"
    else
      echo "Cannot find run.sh"
      status=1
    fi
  else 
    echo "Directory '$project' does not exist."
    status=1
  fi
}

project="$1"
if [ -z "$project" ]; then
  version
  echo "usage: $0 <directory>"
  exit 1
fi

run_project "$project"

if [ "$status" -eq 0 ]; then
  echo "SUCCESS"
  exit 0
else
  echo "FAILURE"
  exit 1
fi
