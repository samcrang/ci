#!/usr/bin/env bash

version() {
  echo "CI 0.0.1"
}

teardown() {
  project="$1"
  if [ -f "$project/teardown.sh" ]; then
    bash "$project/teardown.sh"
  fi
}

project="$1"
if [ -z "$project" ]; then
  version
  echo "usage: $0 <directory>"
  exit 1
fi

if [ -d "$project" ]; then
  if [ -f "$project/run.sh" ]; then
    bash "$project/run.sh" 
    status=$?
    teardown "$project"
 else
    echo "Cannot find run.sh"
    exit 1
  fi
else 
  echo "Directory '$project' does not exist."
  exit 1
fi

if [ "$status" -eq 0 ]; then
  echo "SUCCESS"
  exit 0
else
  echo "FAILURE"
  exit 1
fi
